import{e as B,D as x,E as q,G as E,l as f,f as l,o as d,g as s,v as Q,x as t,y as i,t as n,ct as y,n as j,m as h,F as M,s as C,ab as v,Z as p,ad as D,aw as k,a2 as R,cv as b,_ as G}from"./confirm-HeJGgivB.js";import{P as T}from"./prompt-DHQQ_qzX.js";class g{constructor(a,m){this.width=a,this.height=m}add(a){return new g(this.width+a.width,this.height+a.height)}reduce(a){return new g(this.width-a.width,this.height-a.height)}equals(a){return this.width===a.width&&this.height===a.height}}class F{x;y;width;height;constructor(a,m,r,u){if(m!==void 0&&r!==void 0&&u!==void 0)this.x=a,this.y=m,this.width=r,this.height=u;else{const _=JSON.parse(a);this.x=_.x,this.y=_.y,this.width=_.width,this.height=_.height}}get json(){return JSON.stringify({x:this.x,y:this.y,width:this.width,height:this.height})}get style(){return{left:`${this.x}px`,top:`${this.y}px`,width:`${this.width}px`,height:`${this.height}px`}}get size(){return new g(this.width,this.height)}multiply(a){return new F(this.x*a,this.y*a,this.width*a,this.height*a)}}class w{constructor(a,m){this.x=a,this.y=m}add(a){return new w(this.x+a.x,this.y+a.y)}reduce(a){return new w(this.x-a.x,this.y-a.y)}distanceTo(a){return Math.sqrt((this.x-a.x)**2+(this.y-a.y)**2)}angleTo(a){return Math.atan2(a.y-this.y,a.x-this.x)}multiply(a){return new w(this.x*a,this.y*a)}equals(a){return this.x===a.x&&this.y===a.y}}const J={class:"full"},Z={class:"headers"},z={key:0,class:"entry"},H={class:"label"},K={key:0,class:"label warning"},W={class:"label"},X={class:"key"},Y={class:"key"},tt={key:1},et={class:"key"},st={class:"timestamp"},at={key:2},it={class:"key"},ot={key:3},nt={class:"command"},lt={key:4,class:"timestamp"},dt={key:5},ct={class:"key"},rt={key:6},ht={class:"command"},ut={key:7,class:"timestamp"},vt={class:"row"},mt=["onClick"],pt=["onClick"],_t={key:1,class:"entry"},yt={class:"label"},St={key:0,class:"label warning"},gt={class:"label"},kt={class:"key"},wt={class:"key"},It={class:"key"},xt={class:"timestamp"},ft={key:1},Dt={class:"key"},$t={key:2},Mt={class:"command"},Ct={key:3,class:"timestamp"},Rt={key:4},bt={class:"key"},Tt={key:5},Ft={class:"command"},Ot={key:6,class:"timestamp"},Ut={class:"row"},Nt=["onClick"],Vt=["onClick"],Lt={key:1,class:"main"},Pt={class:"footer"},At={key:0},Bt=B({__name:"MonitorView",props:{size:{type:g,required:!0}},setup(O){let a=null;const m=x(b()),r=x({os:b(),usiSessions:[],csaSessions:[]}),u=x(0);function _(){p.collectSessionStates().then(o=>{m.value=r.value.os,r.value=o,u.value=new Date().getTime()}).catch(o=>{D().add(o)})}function S(o,c){return`${((c-o)/1e3).toFixed(3)} seconds ago`}q(()=>{_(),a=window.setInterval(_,1e3)}),E(()=>{a!==null&&(window.clearInterval(a),a=null)});const U=f(()=>r.value.os.memoryFree/1024**2),$=f(()=>r.value.os.memoryTotal?r.value.os.memoryFree/r.value.os.memoryTotal*100:null),N=f(()=>{const o=r.value.os.cpuTotalTime-m.value.cpuTotalTime,c=r.value.os.cpuIdleTime-m.value.cpuIdleTime;return o?(1-c/o)*100:0});function V(o){p.log(k.INFO,`MonitorView: Open USI prompt for SID=${o.sessionID} Name=[${o.name}]`),p.openPrompt(T.USI,o.sessionID,o.name)}function L(o){R().show({message:`${o.name} に "quit" を送信します。本当に実行しますか？`,onOk:()=>{p.log(k.INFO,`MonitorView: Send USI quit command to SID=${o.sessionID} Name=[${o.name}]`),p.usiQuit(o.sessionID).catch(c=>{D().add(c)})}})}function P(o){p.log(k.INFO,`MonitorView: Open CSA prompt for SID=${o.sessionID} Server=[${o.host}:${o.port}]`);const c=`${o.host}:${o.port}`;p.openPrompt(T.CSA,o.sessionID,c)}function A(o){R().show({message:`${o.host}:${o.port} への接続を強制終了します。本当に実行しますか？`,onOk:()=>{p.log(k.INFO,`MonitorView: Close CSA session for SID=${o.sessionID} Server=[${o.host}:${o.port}]`),p.csaLogout(o.sessionID).catch(c=>{D().add(c)})}})}return(o,c)=>(d(),l("div",null,[s("div",J,[s("div",{ref:"root",class:"full column",onCopy:c[0]||(c[0]=Q(()=>{},["stop"]))},[s("div",Z,[s("div",null,t(i(n).updatedAt)+": "+t(u.value?i(y)(new Date(u.value)):"---"),1),s("div",null,t(i(n).usiEngine)+": "+t(r.value.usiSessions.length),1),s("div",null,t(i(n).csaServer)+": "+t(r.value.csaSessions.length),1)]),u.value?(d(),l("div",{key:0,class:"main",style:j({height:`${O.size.height-38}px`})},[r.value.usiSessions.length===0?(d(),l("div",z,[s("div",H,t(i(n).noRunningUSIEngine),1)])):h("",!0),(d(!0),l(M,null,C(r.value.usiSessions,e=>(d(),l("div",{key:e.sessionID,class:"entry"},[e.closed?(d(),l("div",K,t(i(n).willBeRemovedFromTheListSoon),1)):h("",!0),s("div",W,t(i(n).usiEngine)+" - SID: "+t(e.sessionID),1),s("div",null,[s("span",X,t(i(n).name)+":",1),v(" "+t(e.name),1)]),s("div",null,[c[1]||(c[1]=s("span",{class:"key"},"URI:",-1)),v(" "+t(e.uri),1)]),s("div",null,[s("span",Y,t(i(n).enginePath)+":",1),v(" "+t(e.path),1)]),e.pid?(d(),l("div",tt,[c[2]||(c[2]=s("span",{class:"key"},"PID:",-1)),v(" "+t(e.pid),1)])):h("",!0),s("div",null,[s("span",et,t(i(n).createdAt)+":",1),v(" "+t(i(y)(new Date(e.createdMs)))+" ",1),s("span",st,"("+t(S(e.createdMs,u.value))+")",1)]),s("div",null,[c[3]||(c[3]=s("span",{class:"key"},"State:",-1)),v(" "+t(e.stateCode),1)]),e.lastSent?(d(),l("div",at,[s("span",it,t(i(n).lastSent)+":",1)])):h("",!0),e.lastSent?(d(),l("div",ot,[s("span",nt,t(e.lastSent.command||`(${i(n).blankLine})`),1)])):h("",!0),e.lastSent?(d(),l("div",lt," Sent at "+t(i(y)(new Date(e.lastSent.timeMs)))+" ("+t(S(e.lastSent.timeMs,u.value))+") ",1)):h("",!0),e.lastReceived?(d(),l("div",dt,[s("span",ct,t(i(n).lastReceived)+":",1)])):h("",!0),e.lastReceived?(d(),l("div",rt,[s("span",ht,t(e.lastReceived.command||`(${i(n).blankLine})`),1)])):h("",!0),e.lastReceived?(d(),l("div",ut," Received at "+t(i(y)(new Date(e.lastReceived.timeMs)))+" ("+t(S(e.lastReceived.timeMs,u.value))+") ",1)):h("",!0),s("div",vt,[s("button",{onClick:I=>V(e)},t(i(n).openPrompt),9,mt),s("button",{onClick:I=>L(e)},t(i(n).forceQuit),9,pt)])]))),128)),r.value.csaSessions.length===0?(d(),l("div",_t,[s("div",yt,t(i(n).noConnectedCSAServer),1)])):h("",!0),(d(!0),l(M,null,C(r.value.csaSessions,e=>(d(),l("div",{key:e.sessionID,class:"entry"},[e.closed?(d(),l("div",St,t(i(n).willBeRemovedFromTheListSoon),1)):h("",!0),s("div",gt,t(i(n).csaServer)+" - SID: "+t(e.sessionID),1),s("div",null,[s("span",kt,t(i(n).server)+":",1),v(" "+t(e.host)+":"+t(e.port),1)]),s("div",null,[s("span",wt,t(i(n).protocolVersion)+":",1),v(" "+t(e.protocolVersion),1)]),s("div",null,[c[4]||(c[4]=s("span",{class:"key"},"ID:",-1)),v(" "+t(e.loginID),1)]),s("div",null,[s("span",It,t(i(n).createdAt)+":",1),v(" "+t(i(y)(new Date(e.createdMs)))+" ",1),s("span",xt,"("+t(S(e.createdMs,u.value))+")",1)]),s("div",null,[c[5]||(c[5]=s("span",{class:"key"},"State:",-1)),v(" "+t(e.stateCode),1)]),e.lastSent?(d(),l("div",ft,[s("span",Dt,t(i(n).lastSent)+":",1)])):h("",!0),e.lastSent?(d(),l("div",$t,[s("span",Mt,t(e.lastSent.command||`(${i(n).blankLine})`),1)])):h("",!0),e.lastSent?(d(),l("div",Ct," Sent at "+t(i(y)(new Date(e.lastSent.timeMs)))+" ("+t(S(e.lastSent.timeMs,u.value))+") ",1)):h("",!0),e.lastReceived?(d(),l("div",Rt,[s("span",bt,t(i(n).lastReceived)+":",1)])):h("",!0),e.lastReceived?(d(),l("div",Tt,[s("span",Ft,t(e.lastReceived.command||`(${i(n).blankLine})`),1)])):h("",!0),e.lastReceived?(d(),l("div",Ot," Received at "+t(i(y)(new Date(e.lastReceived.timeMs)))+" ("+t(S(e.lastReceived.timeMs,u.value))+") ",1)):h("",!0),s("div",Ut,[s("button",{onClick:I=>P(e)},t(i(n).openPrompt),9,Nt),s("button",{onClick:I=>A(e)},t(i(n).forceClose),9,Vt)])]))),128))],4)):(d(),l("div",Lt,"Collecting...")),s("div",Pt,[s("span",null,t(r.value.os.version)+"/"+t(r.value.os.arch),1),s("span",null,"CPU Usage: "+t(N.value.toFixed(1))+"%",1),s("span",null,[v(" Memory Free: "+t(U.value.toFixed(2))+"GiB ",1),$.value!==null?(d(),l("span",At,"("+t($.value.toFixed(1))+"%)",1)):h("",!0)])])],544)])]))}}),Qt=G(Bt,[["__scopeId","data-v-81f696bb"]]);export{Qt as M,w as P,g as R,F as a};
